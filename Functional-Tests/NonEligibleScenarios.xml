<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="15abdabf-c61d-472f-a243-b609bb7c4090" discardOkResults="false" failOnError="false" failTestCaseOnErrors="true" keepSession="false" name="NonEligibleScenarios" searchProperties="true" timeout="0" wsrmEnabled="false" wsrmVersion="1.0" wsrmAckTo="" zephyrTestName="" zephyrTestId="" xmlns:con="http://eviware.com/soapui/config"><con:settings><con:setting id="HttpSettings@socket_timeout">80000</con:setting><con:setting id="15abdabf-c61d-472f-a243-b609bb7c4090fileName">NonEligibleScenarios</con:setting></con:settings><con:savedRecentRuns>1</con:savedRecentRuns><con:testStep type="datasource" name="Data Source" id="d72709c3-2ab2-4f70-8b6b-de01617d81e8"><con:settings/><con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dataSource type="Excel"><con:configuration><file>C:/Users/cadikesa/OneDrive - RLI Insurance Company/Documents/PUP/PUP Access/2021/Futurization/ReadyAPI Tests/Connect_Test_Data/Connect_TestData.xlsx</file><worksheet>QuoteNotEligible</worksheet><cell>A2</cell><ignoreEmpty>false</ignoreEmpty><evaluateFormulas>false</evaluateFormulas></con:configuration></con:dataSource><con:shared>true</con:shared><con:restartShared>true</con:restartShared><con:property>TestCase</con:property><con:property>ZipCode</con:property><con:property>EffectiveDate</con:property><con:property>FirstName</con:property><con:property>MiddleInitial</con:property><con:property>LastName</con:property><con:property>Address1</con:property><con:property>City</con:property><con:property>State</con:property><con:property>DOB</con:property><con:property>MovingViolations</con:property><con:property>AtFaultAccidents</con:property><con:property>DUI</con:property><con:property>Vehicles</con:property><con:property>Antique</con:property><con:property>ResidentialProperties</con:property><con:property>ForeignProperties</con:property><con:property>Acreage</con:property><con:property>WaterCraft</con:property><con:property>PersonalWaterCraft</con:property><con:property>learnersPermit</con:property><con:property>AutoLiability</con:property><con:property>UnderwritingQutestions</con:property><con:property>PremiumCoverage</con:property><con:property>UMUIM</con:property><con:property>MoHFirstName</con:property><con:property>MoHInitial</con:property><con:property>MOHLastName</con:property><con:property>LicenseNumber</con:property><con:property>MoHState</con:property><con:property>Relationship</con:property><con:property>NamedInsured2</con:property><con:property>PhoneNumber</con:property><con:property>HomeownersLiability</con:property><con:property>Email</con:property><con:property>ExpectedResult</con:property><con:startRow>0</con:startRow><con:endRow/><con:recordsPerIteration>1</con:recordsPerIteration><con:completeLastOperation>true</con:completeLastOperation><con:trimValues>false</con:trimValues><con:entitizeValues>false</con:entitizeValues><con:restartOnRun>true</con:restartOnRun><con:expandProperties>false</con:expandProperties></con:config></con:testStep><con:testStep type="groovy" name="EffetiveDate" id="bb545552-ffef-477b-bac3-b45e90274498"><con:settings/><con:config><script>def today = new Date()
today.format("MM/dd/yyyy")</script></con:config></con:testStep><con:testStep type="restrequest" name="IntSubmission" id="4cdea633-9645-449e-83ea-20dd10b8d676"><con:settings/><con:config service="Pup Submissions API" resourcePath="/submissions" methodName="POST" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="IntSubmission" id="03c34a5e-7d27-4278-bb14-abba64705ea3" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-RLI-Producer" value="00995" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>https://dev.api.rlicorp.io/pup/v1.0</con:endpoint><con:request>{\r
   "effectiveDate" : "${EffetiveDate#result}",\r
   "contactInformation" : {\r
      "emailAddress" : "${Data Source#Email}",\r
      "primaryAddress" : {\r
         "address1" : "${Data Source#Address1}",\r
         "city" : "${Data Source#City}",\r
         "state" : "${Data Source#State}",\r
         "zip" : "${Data Source#ZipCode}"\r
      }\r
   },\r
   "namedInsured" : {\r
      "firstName" : "${Data Source#FirstName}",\r
      "middleInitial" : "${Data Source#MiddleInitial}",\r
      "lastName" : "${Data Source#LastName}"\r
   }\r
}</con:request><con:originalUri>https://rli.oktapreview.com/oauth2/ausjznb4zBWtHLVYV1d6/v1/authorize</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="a154d9f0-792b-4d28-b991-e18bb76d357e" name="Valid HTTP Status Codes"><con:settings/><con:configuration><codes>201</codes></con:configuration></con:assertion><con:assertion type="JsonPath Existence Match" id="bcb76ed9-f153-46a8-9a6d-456e820ff275" name="Check for existence of [submissionId]"><con:configuration><path>$['submissionId']</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Existence Match" id="48558400-64c3-4389-a8e9-ba8d7606cb46" name="Check for existence of [correlationId]"><con:configuration><path>$['correlationId']</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:username>PUP</con:username><con:password>0oajzmyi5WfLZVDxW1d6:t5qXhlu1hnIybnUGVyQZ0HihoqcPFTxSnYweenAt</con:password><con:selectedAuthProfile>Dev</con:selectedAuthProfile><con:preemptive>false</con:preemptive><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:addedBasicAuthenticationTypes>NTLM</con:addedBasicAuthenticationTypes><con:addedBasicAuthenticationTypes>SPNEGO/Kerberos</con:addedBasicAuthenticationTypes><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters><con:entry key="X-RLI-Producer" value="00995"/></con:parameters><con:environmentSpec><con:entry environmentId="a1acc9d9-dedb-4536-958a-a5cafc7c0d55"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="8c4dd766-676d-4232-a816-b1b61c59538d"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="75114eaf-e15a-4a2d-962b-2c43697c3a81"><con:authProfile>Dev</con:authProfile></con:entry></con:environmentSpec></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="QuickSubmissionWithId" id="1b9fbddc-5548-42dc-9907-5207ac1a58d5"><con:settings/><con:config service="Pup Submissions API" resourcePath="/submissions/{submissionId}/quick" methodName="PUT" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="QuickSubmissionWithId" id="0dfbf44f-0192-40ad-a8f7-dd5569eea512" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://dev.api.rlicorp.io/pup/v1.0</con:endpoint><con:request>{
	"effectiveDate": "${EffetiveDate#result}",
	"namedInsured": {
		"firstName": "${Data Source#FirstName}",
		"middleInitial": "${Data Source#MiddleInitial}",
		"lastName": "${Data Source#LastName}"
	},
	"contactInformation": {
		"emailAddress": "${Data Source#Email}",
		"primaryAddress": {
			"address1": "${Data Source#Address1}",
			"address2": "",
			"city": "${Data Source#City}",
			"state": "${Data Source#State}",
			"zip": "${Data Source#ZipCode}"
		}
	},
	"membersOfHousehold": [
		{
			"dateOfBirth": "${Data Source#DOB}",
			"numberOfMovingViolations": ${Data Source#MovingViolations},
			"numberOfAtFaultAccidents": ${Data Source#AtFaultAccidents},
			"numberOfDuiDwi": ${Data Source#DUI},
			"inExperiencedOrPermitOrNonUsLicense": false,
			"IsLicensed" : true			
		}
	],
	"ratingQuestions": {
		"auto": {
			"numberOfLicensedVehicles": ${Data Source#Vehicles},
			"numberOfAntiqueOrCollectibleVehicles": ${Data Source#Antique}
		},
		"watercraft": {
			"numberOfWatercraft": ${Data Source#WaterCraft},
			"numberOfPersonalWatercraft": ${Data Source#PersonalWaterCraft}
		},
		"property": {
			"numberOfPropertiesOwnedOrRented": ${Data Source#ResidentialProperties},
			"numberOfInternationalPropertiesOwnedOrRented": ${Data Source#ForeignProperties},
			"numberOfAcresOfLand": ${Data Source#Acreage}
		},
		"underlyingCoverage": {
			"agreedMinimumRequiredLimitsOfAutoLiability": "${Data Source#AutoLiability}",
			"agreeToMaintainMinimumRequiredLimitsOfAutoLiability": true,
			"homeownerLiability": ${Data Source#HomeownersLiability}
		}
	},
	"underwritingQuestions": {
		"anyFelonies": false,
		"anyTargetRiskOccupationProfession": false,
		"anyExistingPersonalUmbrellaPolicyWithRLI": false,
		"anyPersonalLiabilityClaimsExceeding50000": false,
		"anyRecklessDriving": false
	}
}</con:request><con:originalUri>https://dev.api.rlicorp.io/pup/v1.0/submissions/0c2e252f-17d6-487e-9de0-8aadb18dd0dc/quick</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="77ac3967-59e7-4110-9804-e05f83649f8a" name="Valid HTTP Status Codes"><con:settings/><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>Inherit From Parent</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters><con:entry key="submissionId" value="${IntSubmission#Response#$['submissionId']}"/><con:entry key="X-RLI-Producer" value="00995"/></con:parameters><con:environmentSpec><con:entry environmentId="75114eaf-e15a-4a2d-962b-2c43697c3a81"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="a1acc9d9-dedb-4536-958a-a5cafc7c0d55"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="8c4dd766-676d-4232-a816-b1b61c59538d"><con:authProfile>Dev</con:authProfile></con:entry></con:environmentSpec></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="CreateQuote" id="2ce728d6-b102-454c-8e23-7c071aa58d03"><con:settings/><con:config service="Pup Quotes API" resourcePath="/quotes" methodName="POST" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="CreateQuote" id="65f7d4b6-5131-485c-92fe-a5761d7ffa61" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-RLI-Producer" value="00995" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>https://dev.api.rlicorp.io/pup/v1.0</con:endpoint><con:request>{
  "SubmissionId": "${QuickSubmissionWithId#Response#$['submissionId']}"
}</con:request><con:originalUri>https://pup.dev.api.rlicorp.io/v1.0/quotes/quotes</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5444ed11-538e-413a-b160-2066f5331597" name="Valid HTTP Status Codes"><con:settings/><con:configuration><codes>201</codes></con:configuration></con:assertion><con:assertion type="JsonPath Existence Match" id="da8f36be-94d2-429f-b12c-97554a8a0e2b" name="Check for existence of [quoteId]"><con:configuration><path>$['quoteId']</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>Inherit From Parent</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters><con:entry key="X-RLI-Producer" value="00995"/></con:parameters><con:environmentSpec><con:entry environmentId="a1acc9d9-dedb-4536-958a-a5cafc7c0d55"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="8c4dd766-676d-4232-a816-b1b61c59538d"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="75114eaf-e15a-4a2d-962b-2c43697c3a81"><con:authProfile>Dev</con:authProfile></con:entry></con:environmentSpec></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="FullSubmissionWithId" id="66c97735-087f-4b19-80bd-a4306d668599"><con:settings/><con:config service="Pup Submissions API" resourcePath="/submissions/{submissionId}/full" methodName="PUT" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="FullSubmissionWithId" id="dd2f9b85-8cb6-4616-b75e-d4b03576131f" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://dev.api.rlicorp.io/pup/v1.0</con:endpoint><con:request>{
  "effectiveDate": "${EffetiveDate#result}",
  "namedInsured": {
    "firstName": "${Data Source#FirstName}",
    "middleInitial": "${Data Source#MiddleInitial}",
    "lastName": "${Data Source#LastName}"
  },
    "secondNamedInsured": {
    "firstName": "Second",
    "middleInitial": "P",
    "lastName": "Insured"
  },
  "contactInformation": {
    "emailAddress": "${Data Source#Email}",
    "phone": "${Data Source#PhoneNumber}",
    "primaryAddress": {
      "address1": "${Data Source#Address1}",
      "address2": "",
      "city": "${Data Source#City}",
      "state": "${Data Source#State}",
      "zip": "${Data Source#ZipCode}"
    }
  },
  "membersOfHousehold": [
    {
      "firstName": "${Data Source#MoHFirstName}",
      "middleInitial": "${Data Source#MoHInitial}",
      "lastName": "${Data Source#MOHLastName}",
      "dateOfBirth": "${Data Source#DOB}",
      "licenseOrPermitNumber": "${Data Source#LicenseNumber}",
      "state": "${Data Source#State}",
      "numberOfMovingViolations": ${Data Source#MovingViolations},
      "numberOfAtFaultAccidents": ${Data Source#AtFaultAccidents},
      "numberOfDuiDwi": ${Data Source#DUI},
      "inExperiencedOrPermitOrNonUsLicense": false,
      "relationshipToApplicant": "PolicyHolder",
      "isLicensed": true
    }
  ],
  "ratingQuestions": {
    "auto": {
      "numberOfLicensedVehicles": ${Data Source#Vehicles},
      "numberOfAntiqueOrCollectibleVehicles": ${Data Source#Antique}
    },
    "watercraft": {
      "numberOfWatercraft": ${Data Source#WaterCraft},
      "numberOfPersonalWatercraft": ${Data Source#PersonalWaterCraft}										
							  
											
    },
						
    "property": {
      "numberOfPropertiesOwnedOrRented": ${Data Source#ResidentialProperties},
      "numberOfInternationalPropertiesOwnedOrRented": ${Data Source#ForeignProperties},
      "numberOfAcresOfLand": ${Data Source#Acreage}
    },
    "underlyingCoverage": {
      "agreedMinimumRequiredLimitsOfAutoLiability": "${Data Source#AutoLiability}",
      "agreeToMaintainMinimumRequiredLimitsOfAutoLiability": true,
      "homeownerLiability": ${Data Source#HomeownersLiability}
    }
  },
  "underwritingQuestions": {
    "anyFelonies": false,
    "anyTargetRiskOccupationProfession": false,
    "anyExistingPersonalUmbrellaPolicyWithRLI": false,
    "anyPersonalLiabilityClaimsExceeding50000": false,
    "anyRecklessDriving": false
  }
  
}</con:request><con:originalUri>https://api.rlicorp.io/pup/v1.0/submissions/594b29d3-3eef-4445-944c-55eb12d2cc79/full</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="d5483162-8353-4c41-bb63-6522f4f5d0bb" name="Valid HTTP Status Codes"><con:settings/><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>Inherit From Parent</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters><con:entry key="submissionId" value="${IntSubmission#Response#$['submissionId']}"/><con:entry key="X-RLI-Producer" value="00995"/></con:parameters><con:environmentSpec><con:entry environmentId="75114eaf-e15a-4a2d-962b-2c43697c3a81"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="a1acc9d9-dedb-4536-958a-a5cafc7c0d55"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="8c4dd766-676d-4232-a816-b1b61c59538d"><con:authProfile>Dev</con:authProfile></con:entry></con:environmentSpec></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="GetSubmission" id="6bf24cf7-3f6b-4eee-8030-035219339494"><con:settings/><con:config service="Pup Submissions API" resourcePath="/submissions/{submissionId}/{correlationId}" methodName="GET" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetSubmission" id="8f3b7ad0-55ec-4507-ade7-7dc6f6493091" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-RLI-Producer" value="00995" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>https://dev.api.rlicorp.io/pup/v1.0</con:endpoint><con:request/><con:originalUri>https://dev.api.rlicorp.io/pup/v1.0/submissions/submissions/</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="4b78d246-a2e0-44b9-840b-63181830ba18" name="Valid HTTP Status Codes" disabled="true"><con:settings/><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Existence Match" id="dc583016-14ff-466e-80cb-dcd9c4f3ed37" name="Check for existence of [referenceNumber]" disabled="true"><con:configuration><path>$['referenceNumber']</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>Inherit From Parent</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters><con:entry key="submissionId" value="${FullSubmissionWithId#Response#$['submissionId']}"/><con:entry key="X-RLI-Producer" value="00995"/><con:entry key="correlationId" value="${FullSubmissionWithId#Response#$['correlationId']}"/></con:parameters><con:environmentSpec><con:entry environmentId="a1acc9d9-dedb-4536-958a-a5cafc7c0d55"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="8c4dd766-676d-4232-a816-b1b61c59538d"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="75114eaf-e15a-4a2d-962b-2c43697c3a81"><con:authProfile>Dev</con:authProfile></con:entry></con:environmentSpec></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="GetSubmissionStatusCheck" id="9682b5b1-9ed2-4360-b472-4aefb42f3517"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )


	def isRetry =  true

	testRunner.runTestStepByName("GetSubmission")
	

	while(isRetry == true )

	{

		def httpResponseHeaders = context.testCase.testSteps["GetSubmission"].testRequest.response.responseHeaders
		def httpStatus = httpResponseHeaders["#status#"]
		def httpStatusCode = (httpStatus =~ "[1-5]\\d\\d")[0]
		
		//log.info("Http Staus code is: " + httpStatusCode)

			if(httpStatusCode == "200")
			{
			//log.info("Http status code is :" + httpStatusCode  + "setting the isRetry to false")
			
			isRetry = false

			//break
			
			}

			else if (httpStatusCode == "202")

			{
			//log.info("Retrying as Http Status code is: " + httpStatusCode)

			testRunner.runTestStepByName("GetSubmission")			

			
			}
			
			else if (httpStatusCode == "400")

			{
			//log.info(" Http Status code is returned , please check the validation errors: " + httpStatusCode)

			isRetry = false
			//break
			
			}
			

			else
			{
				
				throw new Exception("Result not as expected!")
				isRetry = false
				
			}
			
		
 }
	</script></con:config></con:testStep><con:testStep type="restrequest" name="SecondCreateQuote" id="6842fe80-088f-4b5f-b25b-6fa8dce80476"><con:settings/><con:config service="Pup Quotes API" resourcePath="/quotes" methodName="POST" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="SecondCreateQuote" id="65f7d4b6-5131-485c-92fe-a5761d7ffa61" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-RLI-Producer" value="00995" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>https://dev.api.rlicorp.io/pup/v1.0</con:endpoint><con:request>{
  "SubmissionId": "${FullSubmissionWithId#Response#$['submissionId']}"
}</con:request><con:originalUri>https://pup.dev.api.rlicorp.io/v1.0/quotes/quotes</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5444ed11-538e-413a-b160-2066f5331597" name="Valid HTTP Status Codes"><con:settings/><con:configuration><codes>201</codes></con:configuration></con:assertion><con:assertion type="JsonPath Existence Match" id="da8f36be-94d2-429f-b12c-97554a8a0e2b" name="Check for existence of [quoteId]"><con:configuration><path>$['quoteId']</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>Inherit From Parent</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters><con:entry key="X-RLI-Producer" value="00995"/></con:parameters><con:environmentSpec><con:entry environmentId="a1acc9d9-dedb-4536-958a-a5cafc7c0d55"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="8c4dd766-676d-4232-a816-b1b61c59538d"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="75114eaf-e15a-4a2d-962b-2c43697c3a81"><con:authProfile>Dev</con:authProfile></con:entry></con:environmentSpec></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="GetQuote" id="b696e468-971a-4ae8-86a2-fc9e6c5ad60c"><con:settings/><con:config service="Pup Quotes API" resourcePath="/quotes/{quoteId}/{correlationId}" methodName="GET" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetQuote" id="711172c3-75b6-4469-adc8-fa634d180999" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-RLI-Producer" value="00995" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>https://dev.api.rlicorp.io/pup/v1.0</con:endpoint><con:request/><con:originalUri>https://pup.dev.api.rlicorp.io/v1.0/quotes/15c12b86-df63-4b41-968b-050d07af45f4/552be905-f0e0-4139-9962-6f6d84f06914</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="4b2b080e-e2a9-4e32-8e70-bff35d246b2c" name="Valid HTTP Status Codes" disabled="true"><con:settings/><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="MessageContentAssertion" id="a63eba53-5d6e-4499-b401-696347e4a005" name="Message Content Assertion" disabled="true"><con:configuration xsi:type="con:MessageContentAssertion"><con:elements><con:xpath>declare namespace ns1='https://pup.dev.api.rlicorp.io/v1.0/quotes/15c12b86-df63-4b41-968b-050d07af45f4/552be905-f0e0-4139-9962-6f6d84f06914';
//ns1:Response[1]/ns1:referenceNumber[1]</con:xpath><con:element>referenceNumber</con:element><con:type xsi:nil="true"/><con:operator>exists</con:operator><con:enabled>true</con:enabled><con:expectedValue>PUPQT-0001765</con:expectedValue><con:hasValue>false</con:hasValue><con:numberType>false</con:numberType></con:elements><con:originalMessage><![CDATA[<Response xmlns="https://pup.dev.api.rlicorp.io/v1.0/quotes/15c12b86-df63-4b41-968b-050d07af45f4/552be905-f0e0-4139-9962-6f6d84f06914">
   <referenceNumber>PUPQT-0001765</referenceNumber>
   <term>
      <effectiveDate>2021-07-25T00:00:00+00:00</effectiveDate>
      <expirationDate>2022-07-25T00:00:00+00:00</expirationDate>
   </term>
   <quoteValidThrough>2021-07-23T22:14:12.3230843+00:00</quoteValidThrough>
   <quoteOptions>
      <e>
         <quoteOptionId>f4d23d71-eaa5-48a5-b95f-487912e21173</quoteOptionId>
         <totalPremium>167.0</totalPremium>
         <coverages>
            <e>
               <name>Umbrella</name>
               <premium>167.0</premium>
               <type>PERSUMB</type>
               <effectiveDate>2021-07-22T22:14:12.4598069+00:00</effectiveDate>
               <expirationDate>2022-07-22T22:14:12.4598071+00:00</expirationDate>
               <limits>
                  <e>
                     <description/>
                     <type>PERSUMB</type>
                     <value>1000000.0</value>
                  </e>
               </limits>
            </e>
         </coverages>
      </e>
      <e>
         <quoteOptionId>ff2b6ccf-44f4-4b71-b3a1-e4b22b71c9fe</quoteOptionId>
         <totalPremium>309.0</totalPremium>
         <coverages>
            <e>
               <name>Umbrella</name>
               <premium>309.0</premium>
               <type>PERSUMB</type>
               <effectiveDate>2021-07-22T22:14:12.4598551+00:00</effectiveDate>
               <expirationDate>2022-07-22T22:14:12.4598552+00:00</expirationDate>
               <limits>
                  <e>
                     <description/>
                     <type>PERSUMB</type>
                     <value>2000000.0</value>
                  </e>
               </limits>
            </e>
         </coverages>
      </e>
      <e>
         <quoteOptionId>ff862ee3-cd68-481b-a06b-e4fbc9d0c1c9</quoteOptionId>
         <totalPremium>415.0</totalPremium>
         <coverages>
            <e>
               <name>Umbrella</name>
               <premium>415.0</premium>
               <type>PERSUMB</type>
               <effectiveDate>2021-07-22T22:14:12.4599013+00:00</effectiveDate>
               <expirationDate>2022-07-22T22:14:12.4599014+00:00</expirationDate>
               <limits>
                  <e>
                     <description/>
                     <type>PERSUMB</type>
                     <value>3000000.0</value>
                  </e>
               </limits>
            </e>
         </coverages>
      </e>
      <e>
         <quoteOptionId>7559494e-79af-46bb-b745-8616b4b9d053</quoteOptionId>
         <totalPremium>548.0</totalPremium>
         <coverages>
            <e>
               <name>Umbrella</name>
               <premium>548.0</premium>
               <type>PERSUMB</type>
               <effectiveDate>2021-07-22T22:14:12.4599487+00:00</effectiveDate>
               <expirationDate>2022-07-22T22:14:12.4599488+00:00</expirationDate>
               <limits>
                  <e>
                     <description/>
                     <type>PERSUMB</type>
                     <value>5000000.0</value>
                  </e>
               </limits>
            </e>
         </coverages>
      </e>
      <e>
         <quoteOptionId>949b5cb2-2f8c-4ab4-8175-4224991dce02</quoteOptionId>
         <totalPremium>293.0</totalPremium>
         <coverages>
            <e>
               <name>Umbrella</name>
               <premium>167.0</premium>
               <type>PERSUMB</type>
               <effectiveDate>2021-07-22T22:14:12.4371864+00:00</effectiveDate>
               <expirationDate>2022-07-22T22:14:12.4371866+00:00</expirationDate>
               <limits>
                  <e>
                     <description/>
                     <type>PERSUMB</type>
                     <value>1000000.0</value>
                  </e>
               </limits>
            </e>
            <e>
               <name>UM/UIM</name>
               <premium>126.0</premium>
               <type>UMUIM</type>
               <effectiveDate>2021-07-22T22:14:12.4371941+00:00</effectiveDate>
               <expirationDate>2021-08-05T00:00:00+00:00</expirationDate>
               <limits>
                  <e>
                     <description/>
                     <type>UMUIM</type>
                     <value>1000000.0</value>
                  </e>
               </limits>
            </e>
         </coverages>
      </e>
      <e>
         <quoteOptionId>345504b1-e17d-44aa-a511-65ba1dc9e66d</quoteOptionId>
         <totalPremium>435.0</totalPremium>
         <coverages>
            <e>
               <name>Umbrella</name>
               <premium>309.0</premium>
               <type>PERSUMB</type>
               <effectiveDate>2021-07-22T22:14:12.4372237+00:00</effectiveDate>
               <expirationDate>2022-07-22T22:14:12.4372238+00:00</expirationDate>
               <limits>
                  <e>
                     <description/>
                     <type>PERSUMB</type>
                     <value>2000000.0</value>
                  </e>
               </limits>
            </e>
            <e>
               <name>UM/UIM</name>
               <premium>126.0</premium>
               <type>UMUIM</type>
               <effectiveDate>2021-07-22T22:14:12.4372317+00:00</effectiveDate>
               <expirationDate>2021-08-05T00:00:00+00:00</expirationDate>
               <limits>
                  <e>
                     <description/>
                     <type>UMUIM</type>
                     <value>1000000.0</value>
                  </e>
               </limits>
            </e>
         </coverages>
      </e>
      <e>
         <quoteOptionId>65834a70-f399-4f90-b7d8-4ddb69437896</quoteOptionId>
         <totalPremium>541.0</totalPremium>
         <coverages>
            <e>
               <name>Umbrella</name>
               <premium>415.0</premium>
               <type>PERSUMB</type>
               <effectiveDate>2021-07-22T22:14:12.4372735+00:00</effectiveDate>
               <expirationDate>2022-07-22T22:14:12.4372736+00:00</expirationDate>
               <limits>
                  <e>
                     <description/>
                     <type>PERSUMB</type>
                     <value>3000000.0</value>
                  </e>
               </limits>
            </e>
            <e>
               <name>UM/UIM</name>
               <premium>126.0</premium>
               <type>UMUIM</type>
               <effectiveDate>2021-07-22T22:14:12.4372817+00:00</effectiveDate>
               <expirationDate>2021-08-05T00:00:00+00:00</expirationDate>
               <limits>
                  <e>
                     <description/>
                     <type>UMUIM</type>
                     <value>1000000.0</value>
                  </e>
               </limits>
            </e>
         </coverages>
      </e>
      <e>
         <quoteOptionId>0ca45efd-faff-4ddd-a39a-9aa3b6d5cd08</quoteOptionId>
         <totalPremium>674.0</totalPremium>
         <coverages>
            <e>
               <name>Umbrella</name>
               <premium>548.0</premium>
               <type>PERSUMB</type>
               <effectiveDate>2021-07-22T22:14:12.4373089+00:00</effectiveDate>
               <expirationDate>2022-07-22T22:14:12.437309+00:00</expirationDate>
               <limits>
                  <e>
                     <description/>
                     <type>PERSUMB</type>
                     <value>5000000.0</value>
                  </e>
               </limits>
            </e>
            <e>
               <name>UM/UIM</name>
               <premium>126.0</premium>
               <type>UMUIM</type>
               <effectiveDate>2021-07-22T22:14:12.437315+00:00</effectiveDate>
               <expirationDate>2021-08-05T00:00:00+00:00</expirationDate>
               <limits>
                  <e>
                     <description/>
                     <type>UMUIM</type>
                     <value>1000000.0</value>
                  </e>
               </limits>
            </e>
         </coverages>
      </e>
   </quoteOptions>
</Response>]]></con:originalMessage></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>Inherit From Parent</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters><con:entry key="X-RLI-Producer" value="00995"/><con:entry key="correlationId" value="${SecondCreateQuote#Response#$['correlationId']}"/><con:entry key="quoteId" value="${SecondCreateQuote#Response#$['quoteId']}"/></con:parameters><con:environmentSpec><con:entry environmentId="a1acc9d9-dedb-4536-958a-a5cafc7c0d55"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="8c4dd766-676d-4232-a816-b1b61c59538d"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="75114eaf-e15a-4a2d-962b-2c43697c3a81"><con:authProfile>Dev</con:authProfile></con:entry></con:environmentSpec></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="GetQuoteStatusCheck" id="fe2acd72-da51-47b3-82e0-32943c51ff29"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )


	def isRetry =  true

	testRunner.runTestStepByName("GetQuote")
	

	while(isRetry == true )

	{

		def httpResponseHeaders = context.testCase.testSteps["GetQuote"].testRequest.response.responseHeaders
		def httpStatus = httpResponseHeaders["#status#"]
		def httpStatusCode = (httpStatus =~ "[1-5]\\d\\d")[0]
		
		//log.info("Http Staus code is: " + httpStatusCode)

			if(httpStatusCode == "200")
			{
			//log.info("Http status code is :" + httpStatusCode  + "setting the isRetry to false")
			
			isRetry = false

			//break
			
			}

			else if (httpStatusCode == "202")

			{
			//log.info("Retrying as Http Status code is: " + httpStatusCode)

			testRunner.runTestStepByName("GetQuote")			

			
			}
			
			else if (httpStatusCode == "400")

			{
			//log.info(" Http Status code is returned , please check the validation errors: " + httpStatusCode)

			isRetry = false
			//break
			
			}
			

			else
			{
				
				throw new Exception("Result not as expected!")
				isRetry = false
				
			}
			
		
 }
	</script></con:config></con:testStep><con:testStep type="restrequest" name="GetQuoteOption" id="f5b8995b-3593-444d-9879-544de9e51060"><con:settings/><con:config service="Pup Quotes API" resourcePath="/quotes/{quoteId}/{correlationId}/quoteoptions" methodName="GET" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetQuoteOption" id="e51ee750-d58b-4da0-83f4-f34593ecbea1" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;entry key="X-RLI-Producer" value="12345" xmlns="http://eviware.com/soapui/config"/></con:setting></con:settings><con:endpoint>https://dev.api.rlicorp.io/pup/v1.0</con:endpoint><con:request/><con:originalUri>https://dev.api.rlicorp.io/pup/v1.0/quotes/24b8bed2-c8d4-4f01-9ab3-97d3796f09ba/a3715211-6b38-4b19-8ba1-a981d551d3dc/quoteoptions</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="c2601d33-53f5-47c9-8ac7-420499ce5008" name="Valid HTTP Status Codes" disabled="true"><con:settings/><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Existence Match" id="377973af-5283-481c-8b1d-8688512d74c2" name="Check for existence of [quoteOptionId]" disabled="true"><con:configuration><path>$[0]['quoteOptionId']</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>Inherit From Parent</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters><con:entry key="X-RLI-Producer" value="00995"/><con:entry key="correlationId" value="${SecondCreateQuote#Response#$['correlationId']}"/><con:entry key="quoteId" value="${SecondCreateQuote#Response#$['quoteId']}"/></con:parameters><con:environmentSpec><con:entry environmentId="a1acc9d9-dedb-4536-958a-a5cafc7c0d55"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="8c4dd766-676d-4232-a816-b1b61c59538d"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="75114eaf-e15a-4a2d-962b-2c43697c3a81"><con:authProfile>Dev</con:authProfile></con:entry></con:environmentSpec></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="GetQuoteOptionStatusCheck" id="18474231-2ab3-4880-86d2-74d37d685db6"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )


	def isRetry =  true

	testRunner.runTestStepByName("GetQuoteOption")
	

	while(isRetry == true )

	{

		def httpResponseHeaders = context.testCase.testSteps["GetQuoteOption"].testRequest.response.responseHeaders
		def httpStatus = httpResponseHeaders["#status#"]
		def httpStatusCode = (httpStatus =~ "[1-5]\\d\\d")[0]
		
		//log.info("Http Staus code is: " + httpStatusCode)

			if(httpStatusCode == "200")
			{
			//log.info("Http status code is :" + httpStatusCode  + "setting the isRetry to false")
			
			isRetry = false

			//break
			
			}

			else if (httpStatusCode == "202")

			{
			//log.info("Retrying as Http Status code is: " + httpStatusCode)

			testRunner.runTestStepByName("GetQuote")			

			
			}
			
			else if (httpStatusCode == "400")

			{
			//log.info(" Http Status code is returned , please check the validation errors: " + httpStatusCode)

			isRetry = false
			//break
			
			}
			

			else
			{
				
				throw new Exception("Result not as expected!")
				isRetry = false
				
			}
			
		
 }
	</script></con:config></con:testStep><con:testStep type="groovy" name="QuoteOptionValidation" id="51da2eb6-75cc-4a6b-be04-fe624af3065f"><con:settings/><con:config><script>import groovy.json.JsonSlurper
def response = context.expand( '${GetQuoteOption#Response}' )

def errorResponse = context.expand( '${GetQuoteOption#Response#$[\'errors\'][\'Summary\'][0]}' )


def state = context.expand( '${Data Source#State}' )


def slurper = new JsonSlurper()
def result = slurper.parseText(response)
def policyCount = 0

log.info(result)

if (state == "VT")

{
	log.info ("Quote Option Not returned")

	assert errorResponse == "Drivers may not have underlying limits of 100/300"

	}

	else
	{
		def quoteCount = result.quoteOptionId.size()

		log.info("Quote Count: " + quoteCount)
		assert quoteCount == 4
		}

</script></con:config></con:testStep><con:testStep type="groovy" name="PremiumSelection" id="d88d6054-e557-42c4-a556-116da7d28cff"><con:settings/><con:config><script><![CDATA[def oneMillion = context.expand( '${GetQuoteOption#Response#$[0][\'quoteOptionId\']}' )

def twoMillion = context.expand( '${GetQuoteOption#Response#$[1][\'quoteOptionId\']}' )

def threeMillion = context.expand( '${GetQuoteOption#Response#$[2][\'quoteOptionId\']}' )

def fiveMillion = context.expand( '${GetQuoteOption#Response#$[3][\'quoteOptionId\']}' )

def oneMillionWithUMUIM  = context.expand( '${GetQuoteOption#Response#$[4][\'quoteOptionId\']}' )



def premiumCoverage = context.expand( '${Data Source#PremiumCoverage}' )

log.info("Premiumcoverage: "+ premiumCoverage)


def uMUIM = context.expand( '${Data Source#UMUIM}' )

log.info("UMUIM coverage: " + uMUIM)


def state = context.expand( '${Data Source#State}' )

def quoteId = null;


if(premiumCoverage == "1 Million"  && uMUIM == "No" || premiumCoverage == "1 Million"  && uMUIM == "Reject")
{
	return quoteId = oneMillion
	
	}
else if (premiumCoverage == "2 Million" && uMUIM == "No" || premiumCoverage == "2 Million"  && uMUIM == "Reject")

{
	
	return quoteId = twoMillion
	}

	else if (premiumCoverage == "3 Million" && uMUIM == "No" || premiumCoverage == "3 Million"  && uMUIM == "Reject")

{
	
	return quoteId = threeMillion
	}

	else if (premiumCoverage == "5 Million"  && uMUIM == "No" || premiumCoverage == "5 Million"  && uMUIM == "Reject")

{
	
	return quoteId = fiveMillion
	}




log.info ("QuoteId: "+ quoteId)

	

	
]]></script></con:config></con:testStep><con:testStep type="restrequest" name="BinderRequests2" id="3a869248-e394-414a-9b1c-9f5f3c8037be"><con:settings/><con:config service="Pup Binder Requests API" resourcePath="/binderrequests" methodName="POST" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="BinderRequests2" id="ebd9a177-ca7c-4b7a-a810-beec38628268" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://dev.api.rlicorp.io/pup/v1.0</con:endpoint><con:request>{\r
   "quoteOptionId" : "${PremiumSelection#result}",\r
   "interactive" : false\r
}</con:request><con:originalUri>https://api.rlicorp.io/pup/v1.0/binderrequests</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="64f0fee0-99cb-4cbd-8779-b01498c80154" name="Valid HTTP Status Codes" disabled="true"><con:settings/><con:configuration><codes>201</codes></con:configuration></con:assertion><con:assertion type="JsonPath Existence Match" id="1834fd33-9d95-4fbd-ae97-2ac1b8b6892f" name="Check for existence of [binderRequestId]" disabled="true"><con:configuration><path>$['binderRequestId']</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>Inherit From Parent</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters><con:entry key="X-RLI-Producer" value="00995"/></con:parameters><con:environmentSpec><con:entry environmentId="75114eaf-e15a-4a2d-962b-2c43697c3a81"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="a1acc9d9-dedb-4536-958a-a5cafc7c0d55"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="8c4dd766-676d-4232-a816-b1b61c59538d"><con:authProfile>Dev</con:authProfile></con:entry></con:environmentSpec></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="GetBinderRequests" id="46de1a13-3aac-4703-ae2e-a56cc88ea9a5"><con:settings/><con:config service="Pup Binder Requests API" resourcePath="/binderrequests/{binderRequestId}/{correlationId}" methodName="GET" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetBinderRequests" id="6f256a27-4c73-4cdd-9cff-8a1587e87609" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://dev.api.rlicorp.io/pup/v1.0</con:endpoint><con:request/><con:originalUri>https://api.rlicorp.io/pup/v1.0/binderrequests/82c0a66d-fce0-41ab-8c0d-21d29d1b2648/634edce4-17d0-48c6-9e66-44999bef6b26</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="5ac4ee16-8e32-4706-84b7-52a83b6df41f" name="Valid HTTP Status Codes" disabled="true"><con:settings/><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>Dev</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters><con:entry key="X-RLI-Producer" value="00995"/><con:entry key="binderRequestId" value="${BinderRequests2#Response#$['binderRequestId']}"/><con:entry key="correlationId" value="${BinderRequests2#Response#$['correlationId']}"/></con:parameters><con:environmentSpec><con:entry environmentId="75114eaf-e15a-4a2d-962b-2c43697c3a81"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="a1acc9d9-dedb-4536-958a-a5cafc7c0d55"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="8c4dd766-676d-4232-a816-b1b61c59538d"><con:authProfile>Dev</con:authProfile></con:entry></con:environmentSpec></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="GetBinderRequestsStatusCheck" id="61cf3af8-ba8f-49b9-96ba-5115659d536a"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )


	def isRetry =  true

	testRunner.runTestStepByName("GetBinderRequests")
	

	while(isRetry == true )

	{

		def httpResponseHeaders = context.testCase.testSteps["GetBinderRequests"].testRequest.response.responseHeaders
		def httpStatus = httpResponseHeaders["#status#"]
		def httpStatusCode = (httpStatus =~ "[1-5]\\d\\d")[0]
		
		//log.info("Http Staus code is: " + httpStatusCode)

			if(httpStatusCode == "200")
			{
			//log.info("Http status code is :" + httpStatusCode  + "setting the isRetry to false")
			
			isRetry = false

			//break
			
			}

			else if (httpStatusCode == "202")

			{
			//log.info("Retrying as Http Status code is: " + httpStatusCode)

			testRunner.runTestStepByName("GetBinderRequests")			

			
			}
			
			else if (httpStatusCode == "400")

			{
			//log.info(" Http Status code is returned , please check the validation errors: " + httpStatusCode)

			isRetry = false
			//break
			
			}
			

			else
			{
				
				throw new Exception("Result not as expected!")
				isRetry = false
				
			}
			
		
 }
	</script></con:config></con:testStep><con:testStep type="groovy" name="PaymentURL" id="6529248b-72de-49b9-a46a-2021bcd7d5cb"><con:settings/><con:config><script>import org.apache.poi.ss.usermodel.Cell 
import org.apache.poi.ss.usermodel.Row 
import org.apache.poi.xssf.usermodel.XSSFSheet 
import org.apache.poi.xssf.usermodel.XSSFWorkbook 

import java.io.FileOutputStream 
import java.io.IOException 
import java.util.List 

XSSFWorkbook workbook = new XSSFWorkbook() 
XSSFSheet sheet = workbook.createSheet("Payment") 

def response = context.expand( '${GetBinderRequests#Response#$[\'paymentUrl\']}' )


int rowNum = 0 
int colNum = 0 

headers = ["URLRetrieved"] 

Row row = sheet.createRow(rowNum) 
for(String header : headers) {
  Cell cell = row.createCell(colNum++) 
  cell.setCellValue(header) 
}

rowNum = 1
colNum = 0

row = sheet.createRow(rowNum++) 
Cell cell = row.createCell(colNum++) 
cell.setCellValue(response) 

log.info("PaymentURL: " + response)


try {
    FileOutputStream outputStream = new FileOutputStream("C:/CHITRA/Source/Repos/Test/TestData/PaymentURL.xlsx") 
    workbook.write(outputStream) 
    workbook.close() 
} catch (IOException e) {
    e.printStackTrace() 
}</script></con:config></con:testStep><con:testStep type="delay" name="Delay 6" id="2f8b4081-bd38-407e-a7bf-4e82dc6a1985"><con:settings/><con:config><delay>3000</delay></con:config></con:testStep><con:testStep type="groovy" name="SignatureURL" id="f833b650-c0d2-436b-b21f-8e55226990ef"><con:settings/><con:config><script>import org.apache.commons.lang3.StringUtils;

def response = context.expand( '${GetBinderRequests#Response#$[\'signatureUrl\']}' )

log.info("response: " + response)

def sub = StringUtils.substringBetween(response, "dev.sign.rlicorp.com/", "?");

log.info("Extracted URL: " + sub)

return sub

</script></con:config></con:testStep><con:testStep type="restrequest" name="DocuSignURL" id="8db9a9bb-dd53-4403-bea8-f99884152bd5"><con:settings/><con:config service="https://dev.sign.rlicorp.com" resourcePath="/{BinderRequestId}/Complete" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="DocuSignURL" id="9f11ef79-d211-46a3-b9bc-c1e30cd054aa" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://dev.sign.rlicorp.com</con:endpoint><con:request/><con:originalUri>https://dev.sign.rlicorp.com/Complete</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="44cc3f76-210d-461d-8e19-a2f765b20316" name="Valid HTTP Status Codes"><con:settings/><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters><con:entry key="BinderRequestId" value="${SignatureURL#result}"/><con:entry key="event" value="signing_complete"/></con:parameters><con:parameterOrder><con:entry>BinderRequestId</con:entry><con:entry>event</con:entry></con:parameterOrder><con:environmentSpec><con:entry environmentId="a1acc9d9-dedb-4536-958a-a5cafc7c0d55"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="8c4dd766-676d-4232-a816-b1b61c59538d"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec></con:restRequest></con:config></con:testStep><con:testStep type="tcintegrationteststep" name="TestComplete 2" id="faed4d84-ddaf-48f0-9f21-155936e28255"><con:settings/><con:config><timeout>90000</timeout><executionResult>0</executionResult><resultDescription/><testRunner>TestComplete 14</testRunner><runMode>TEST</runMode><exportTestLog>C:\CHITRA\Source\Repos\Test\TestData\TestLog\Log.txt</exportTestLog><silentModeLog>C:\CHITRA\Source\Repos\Test\TestData\TestLog\SilentModeLog.txt</silentModeLog><projectSuiteFile>C:\CHITRA\Source\Repos\TestComplete\Connect\Connect.pjs</projectSuiteFile><projectName>PUP</projectName><scriptUnit>LaunchBrowser</scriptUnit><scriptRoutine>LaunchBrowser</scriptRoutine><silentMode>true</silentMode><showTestLog>true</showTestLog><warningAsError>false</warningAsError><test>ConnectPayment</test><otherTest/><otherArgs/></con:config></con:testStep><con:testStep type="restrequest" name="GetBinderId" id="ca5feb58-70ea-4bcb-8667-f03cce66e60a"><con:settings/><con:config service="Pup Binders API" resourcePath="/binders/{binderId}" methodName="GET" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetBinderId" id="2804bdee-9191-4076-8a56-8491a7957f24" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://dev.api.rlicorp.io/pup/v1.0</con:endpoint><con:request/><con:originalUri>https://dev.api.rlicorp.io/pup/v1.0/binders/ac6c0951-872a-43a3-9b10-bd38635907eb</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="2e50331d-49a4-4674-b056-65074daf3c74" name="Valid HTTP Status Codes"><con:settings/><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Existence Match" id="7ba80a51-145b-4f5f-94eb-2ea42dd651e5" name="Check for existence of [policyNumber]"><con:configuration><path>$['policyNumber']</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>Dev</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters><con:entry key="binderId" value="${BinderRequests2#Response#$['binderRequestId']}"/><con:entry key="X-RLI-Producer" value="00995"/></con:parameters><con:environmentSpec><con:entry environmentId="75114eaf-e15a-4a2d-962b-2c43697c3a81"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="a1acc9d9-dedb-4536-958a-a5cafc7c0d55"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="8c4dd766-676d-4232-a816-b1b61c59538d"><con:authProfile>Dev</con:authProfile></con:entry></con:environmentSpec></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="GetBinderIDPolicyCheck" id="e91a7db9-fe7a-4ec4-afbb-7e1c373699c0"><con:settings/><con:config><script>def groovyUtils = new com.eviware.soapui.support.GroovyUtils( context )


	def isRetry =  true

	testRunner.runTestStepByName("GetBinderId")
	

	while(isRetry == true )

	{

		def httpResponseHeaders = context.testCase.testSteps["GetBinderId"].testRequest.response.responseHeaders
		def httpStatus = httpResponseHeaders["#status#"]
		def httpStatusCode = (httpStatus =~ "[1-5]\\d\\d")[0]
		
		//log.info("Http Staus code is: " + httpStatusCode)

			if(httpStatusCode == "200")
			{
			//log.info("Http status code is :" + httpStatusCode  + "setting the isRetry to false")
			
			isRetry = false

			//break
			
			}

			else if (httpStatusCode == "202")

			{
			//log.info("Retrying as Http Status code is: " + httpStatusCode)

			testRunner.runTestStepByName("GetBinderRequests")			

			
			}
			
			else if (httpStatusCode == "400")

			{
			//log.info(" Http Status code is returned , please check the validation errors: " + httpStatusCode)

			isRetry = false
			//break
			
			}
			

			else
			{
				
				throw new Exception("Result not as expected!")
				isRetry = false
				
			}
			
		
 }
	</script></con:config></con:testStep><con:testStep type="restrequest" name="GetPolicyDetails" id="26b964ad-37bd-49bc-9dde-9cf102e410ae"><con:settings/><con:config service="Pup Policies API" resourcePath="/policies/{policyNumber}" methodName="GET" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetPolicyDetails" id="11769595-62fe-498c-9b88-904eb6213f43" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://dev.api.rlicorp.io/pup/v1.0</con:endpoint><con:request/><con:originalUri>https://api.rlicorp.io/pup/v1.0/policies/PUP0000025</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="3e77c0df-45d8-4bd3-a943-b4addad7374c" name="Valid HTTP Status Codes"><con:settings/><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="JsonPath Existence Match" id="814e3548-9891-4096-9c38-007fab623d60" name="Check for existence of [premium]"><con:configuration><path>$['premium']</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Existence Match" id="2af37f19-75f9-4b93-91d2-f7bc7c5ef5f3" name="Check for existence of [name]"><con:configuration><path>$['documents'][1]['name']</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Existence Match" id="5c77fc2f-ea79-42d0-87df-3ea1c9bc4423" name="Check for existence of [name]"><con:configuration><path>$['documents'][0]['name']</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>Inherit From Parent</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters><con:entry key="X-RLI-Producer" value="00995"/><con:entry key="policyNumber" value="${GetBinderId#Response#$['policyNumber']}"/></con:parameters><con:environmentSpec><con:entry environmentId="75114eaf-e15a-4a2d-962b-2c43697c3a81"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="a1acc9d9-dedb-4536-958a-a5cafc7c0d55"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="8c4dd766-676d-4232-a816-b1b61c59538d"><con:authProfile>Dev</con:authProfile></con:entry></con:environmentSpec></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="GetDBinderocument" id="3bbd2f42-4f23-431b-afb4-80eb3a341467"><con:settings/><con:config service="Pup Documents API" resourcePath="/documents/{documentId}" methodName="GET" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetDBinderocument" id="86b781c1-67c2-4e57-b1da-52346cd1f040" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://dev.api.rlicorp.io/pup/v1.0</con:endpoint><con:request/><con:originalUri>https://dev.api.rlicorp.io/pup/v1.0/documents/ea954bb1-e425-417e-ba97-41a1cba69072</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="4c08ac47-8853-4f2a-bfc1-33a0e3771a03" name="Valid HTTP Status Codes"><con:settings/><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>Dev</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters><con:entry key="X-RLI-Producer" value="00995"/><con:entry key="documentId" value="${GetPolicyDetails#Response#$['documents'][1]['documentId']}"/></con:parameters><con:environmentSpec><con:entry environmentId="75114eaf-e15a-4a2d-962b-2c43697c3a81"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="a1acc9d9-dedb-4536-958a-a5cafc7c0d55"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="8c4dd766-676d-4232-a816-b1b61c59538d"><con:authProfile>Dev</con:authProfile></con:entry></con:environmentSpec></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="GetApplicationDocument" id="272d8ac4-bc6c-4169-a8a9-8285cc05805b"><con:settings/><con:config service="Pup Documents API" resourcePath="/documents/{documentId}" methodName="GET" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="GetApplicationDocument" id="86b781c1-67c2-4e57-b1da-52346cd1f040" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://dev.api.rlicorp.io/pup/v1.0</con:endpoint><con:request/><con:originalUri>https://dev.api.rlicorp.io/pup/v1.0/documents/ea954bb1-e425-417e-ba97-41a1cba69072</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="4c08ac47-8853-4f2a-bfc1-33a0e3771a03" name="Valid HTTP Status Codes"><con:settings/><con:configuration><codes>200</codes></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>Inherit From Parent</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters><con:entry key="X-RLI-Producer" value="00995"/><con:entry key="documentId" value="${GetPolicyDetails#Response#$['documents'][0]['documentId']}"/></con:parameters><con:environmentSpec><con:entry environmentId="75114eaf-e15a-4a2d-962b-2c43697c3a81"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="a1acc9d9-dedb-4536-958a-a5cafc7c0d55"><con:authProfile>Dev</con:authProfile></con:entry><con:entry environmentId="8c4dd766-676d-4232-a816-b1b61c59538d"><con:authProfile>Dev</con:authProfile></con:entry></con:environmentSpec></con:restRequest></con:config></con:testStep><con:testStep type="datasourceloop" name="Data Source Loop" id="93d54e7c-f04d-4433-8b59-50095574cb8b"><con:settings/><con:config><dataSourceStep>Data Source</dataSourceStep><targetStep>EffetiveDate</targetStep><discardResults>true</discardResults></con:config></con:testStep><con:properties/><con:reportParameters/><con:breakPoints><con:testStepId>0d532156-9da6-447c-8a1f-f460df287ae0</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>ac8179a3-22ca-4604-978e-1a46479800f3</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>58a06ac5-9c8a-4fcb-9e0e-a253b3ceed98</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>025e4ecf-6498-4671-8ac0-fd6005161ebd</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>d464183d-ad8f-46f9-badc-f6903b4b1710</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>aa8d3ee3-d945-4e9c-b5cf-f84835e6667f</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>838952a3-b9c5-4ee0-b592-fc650aed3c36</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>8b59a77e-5e25-47c5-9b66-7f061630a5be</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>d1a788be-8bc2-436c-b24c-0c25fd7914ae</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>937afd97-85d1-4f18-859d-ebdeb3f75865</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>14d7ce96-dbc7-4adc-979a-e887261b548e</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>6783d48d-0a29-4496-b112-b735e617819e</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>2826ce80-cffc-4bc3-8fae-5b4040858ac2</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bf6bb967-c091-43a8-a503-d1a4a7e0499a</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>dd2afcd8-e311-43e2-bf30-4564ebadc866</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>102585e4-a88b-4f67-8906-c58ec18c8867</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>63b392b5-807e-4acf-8e58-65a182f3e219</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>04c03401-aeef-4a02-a7ff-b7fa07da8658</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>2c6ca653-9278-4717-9fcd-fe9ac57f71c3</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>4831f672-6bed-43b8-a656-2dc3e1cf5ba0</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>87de93f5-54b6-46ed-8ac7-ef3016bc8d69</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:environmentSpec><con:entry environmentId="a1acc9d9-dedb-4536-958a-a5cafc7c0d55"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="8c4dd766-676d-4232-a816-b1b61c59538d"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec></con:testCase>
